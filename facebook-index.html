    <!-- Publicaciones de Facebook -->
  <div id="facebookPostsContainer" class="container" style="padding: 20px 8px; max-width: 1200px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 20px; position: relative; overflow: hidden; box-shadow: 0 4px 8px 3px rgba(0, 0, 0, 0.15), 0 1px 3px 0 rgba(0, 0, 0, 0.3);">
    <!-- Wallpaper decorativo de fondo -->
    <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-image: url('./img/fb-wallpaper.png'); background-repeat: repeat; background-size: 200px; background-position: center; opacity: 0.3; pointer-events: none;"></div>
    <!-- Las publicaciones se cargar√°n din√°micamente desde facebook-posts.json -->
  </div>

  <style>
    #facebookPostsContainer {
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      gap: 20px;
      margin: 40px auto;
      padding: 20px 8px !important;
      align-items: stretch;
      justify-content: center;
    }

    .fb-post-wrapper {
      background: rgba(255, 255, 255, 0.98);
      border-radius: 16px;
      padding: 0;
      max-width: 360px;
      width: auto;
      flex: 0 1 auto;
      box-shadow: 
        0 1px 2px 0 rgba(0, 0, 0, 0.3),
        0 2px 6px 2px rgba(0, 0, 0, 0.15);
      transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
      animation: fadeInUp 0.6s ease-out forwards;
      opacity: 0;
      position: relative;
      z-index: 1;
      display: inline-flex;
      flex-direction: column;
      align-items: center;
      overflow: hidden;
    }

    /* Wrapper con ancho personalizado */
    .fb-post-wrapper.custom-width {
      max-width: 700px !important;
    }

    /* Full row (ej. videos apaisados) */
    .fb-post-wrapper.full-row {
      flex: 0 1 100% !important;
      max-width: 100% !important;
      width: 100% !important;
    }

    .fb-embed-container.video-full {
      width: 100%;
      padding: 0 6px 12px 6px;
    }

    .fb-embed-container.video-full video {
      width: 100% !important;
      height: auto !important;
      aspect-ratio: 16/9;
      object-fit: cover;
      display: block;
      border-radius: 12px;
      max-height: 600px;
    }

    /* Mobile: usar contain para videos apaisados */
    @media (max-width: 768px) {
      .fb-embed-container.video-full video {
        object-fit: contain;
        max-height: 400px;
        background: #000;
      }
      
      .fb-post-wrapper.full-row .fb-post-title,
      .fb-post-wrapper.full-row .fb-post-description {
        padding-left: 20px;
        padding-right: 20px;
      }
    }
    
    /* Responsivo para tablets */
    @media (max-width: 992px) {
      .fb-post-wrapper {
        max-width: 340px;
      }
    }
    
    /* Responsivo para m√≥viles */
    @media (max-width: 768px) {
      #facebookPostsContainer {
        flex-direction: column;
        gap: 20px;
      }
      
      .fb-post-wrapper {
        max-width: calc(100% - 40px);
        margin: 0 auto;
      }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .fb-post-wrapper:hover {
      box-shadow: 
        0 4px 8px 3px rgba(0, 0, 0, 0.15),
        0 1px 3px 0 rgba(0, 0, 0, 0.3);
      transform: translateY(-4px) scale(1.01);
    }

    .fb-post-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: #1877f2;
      margin-bottom: 8px;
      padding: 15px 12px 0 12px;
      min-width: 280px;
      text-align: center;
    }

    .fb-post-description {
      font-size: 1.1rem;
      color: #65676b;
      margin-top: 0;
      padding: 0 12px 12px 12px;
      min-width: 280px;
      text-align: center;
      line-height: 1.6;
    }

    /* Contenedor del video o embed */
    .fb-embed-container {
      position: relative;
      width: auto;
      display: flex;
      justify-content: center;
      overflow: hidden;
      padding: 0 8px 8px 8px;
    }

    /* Contenedor ancho para posts de Facebook grandes */
    .fb-embed-container.wide {
      padding: 0 2px 6px 2px;
    }

    /* Estilos para videos locales */
    .fb-embed-container video {
      max-width: 100%;
      max-height: 500px;
      width: auto;
      height: auto;
      object-fit: contain;
    }

    /* SDK de Facebook - ajustar ancho y centrar */
    .fb-post {
      margin: 0 auto;
      max-width: 100% !important;
      display: flex;
      justify-content: center;
    }

    /* Wrapper con overflow para el zoom - solo afecta al iframe */
    .fb-post-zoom {
      position: relative;
    }

    .fb-post-zoom iframe {
      transform-origin: center center;
      transition: transform 0.3s ease;
    }

    /* Forzar que las im√°genes de FB se vean m√°s grandes y centradas */
    .fb-post iframe {
      width: 100% !important;
      max-width: 100% !important;
      margin: 0 auto !important;
      display: block !important;
    }

    .fb-post > span {
      display: flex !important;
      justify-content: center !important;
      width: 100% !important;
    }

    @media (max-width: 768px) {
      #facebookPostsContainer {
        padding: 20px 8px !important;
        border-radius: 12px;
        width: 98vw;
        max-width: 98vw;
        margin: 40px auto;
        gap: 25px;
      }
      
      .fb-post-wrapper {
        padding: 0;
        max-width: 95vw;
      }

      .fb-post-title {
        font-size: 1.1rem;
        padding: 20px 20px 0 20px;
      }
      
      .fb-post-description {
        padding: 0 20px 20px 20px;
      }
      
      .fb-embed-container {
        padding: 8px 10px;
      }
      
      .fb-embed-container video {
        max-height: 400px;
      }
    }

    @media (min-width: 769px) {
      .fb-post {
        min-width: 550px !important;
        display: flex !important;
        justify-content: center !important;
      }
    }
  </style>

  <!-- SDK de Facebook para embeds elegantes -->
  <script async defer crossorigin="anonymous" 
          src="https://connect.facebook.net/es_LA/sdk.js#xfbml=1&version=v18.0"></script>
  
  <!-- SDK de Instagram para embeds -->
  <script async src="https://www.instagram.com/embed.js"></script>

  <script>
    (function() {
      'use strict';
      
      console.log('üöÄ Script de Facebook Posts iniciado');
      
      const CACHE_KEY = 'facebook_posts_cache';
      const CACHE_DURATION = 3600000; // 1 hora
      let postsLoaded = false; // Bandera para evitar cargas duplicadas
      
      function sortPosts(posts) {
        // Filtrar posts ignorados (position === -1)
        const activePosts = posts.filter(p => p.position !== -1);
        
        if (activePosts.length === 0) return [];
        
        const fixedPosts = activePosts.filter(p => p.position > 0).sort((a, b) => a.position - b.position);
        const randomPosts = activePosts.filter(p => p.position === 0);
        
        // Mezclar aleatorios
        for (let i = randomPosts.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [randomPosts[i], randomPosts[j]] = [randomPosts[j], randomPosts[i]];
        }
        
        const result = [];
        const maxPosition = Math.max(activePosts.length, ...fixedPosts.map(p => p.position));
        let randomIndex = 0;
        
        for (let i = 1; i <= maxPosition; i++) {
          const fixedPost = fixedPosts.find(p => p.position === i);
          if (fixedPost) {
            result.push(fixedPost);
          } else if (randomIndex < randomPosts.length) {
            result.push(randomPosts[randomIndex++]);
          }
        }
        
        while (randomIndex < randomPosts.length) {
          result.push(randomPosts[randomIndex++]);
        }
        
        return result;
      }
      
      function generatePostHTML(post, index) {
        const title = post.title ? `<div class="fb-post-title">${post.title}</div>` : '';
        const description = post.description ? `<div class="fb-post-description">${post.description}</div>` : '';
        
        // Determinar tipo de contenido
        const type = post.type || (post.url && post.url.includes('instagram.com') ? 'instagram' : 'facebook');

        // VIDEO LOCAL
        if (type === 'video') {
          const autoplay = post.autoplay !== false;
          const loop = post.loop !== false;
          const muted = post.muted !== false;
          const controls = post.controls !== false;
          const posterAttr = post.poster ? `poster="${post.poster}"` : '';
          const isFull = post.layout === 'full-row' || post.orientation === 'landscape';
          const wrapperClass = isFull ? 'fb-post-wrapper full-row' : 'fb-post-wrapper';
          const containerClass = isFull ? 'fb-embed-container video-full' : 'fb-embed-container';

          // Usamos data-src para lazy-load y control desde IntersectionObserver
          return `
            <div class="${wrapperClass}" style="animation-delay: ${index * 0.1}s" data-autoplay="${autoplay}">
              ${title}
              <div class="${containerClass}">
                <video data-src="${post.url}" ${loop ? 'loop' : ''} ${muted ? 'muted' : ''} ${controls ? 'controls' : ''} ${posterAttr} playsinline preload="metadata" style="border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
                  <!-- source ser√° asignado al hacer lazy-load -->
                </video>
              </div>
              ${description}
            </div>
          `;
        }
        
        // INSTAGRAM
        if (type === 'instagram') {
          return `
            <div class="fb-post-wrapper" style="animation-delay: ${index * 0.1}s">
              ${title}
              <div class="fb-embed-container" style="display: flex; justify-content: center;">
                <blockquote class="instagram-media" data-instgrm-captioned data-instgrm-permalink="${post.url}" data-instgrm-version="14" 
                            style="background:#FFF; border:0; border-radius:3px; box-shadow:0 0 1px 0 rgba(0,0,0,0.5),0 1px 10px 0 rgba(0,0,0,0.15); 
                            margin: 1px; max-width:540px; min-width:326px; padding:0; width:99.375%; width:-webkit-calc(100% - 2px); 
                            width:calc(100% - 2px);">
                  <div style="padding:16px;">
                    <a href="${post.url}" style="background:#FFFFFF; line-height:0; padding:0 0; text-align:center; 
                       text-decoration:none; width:100%;" target="_blank" rel="noopener noreferrer">Ver publicaci√≥n en Instagram</a>
                  </div>
                </blockquote>
              </div>
              ${description}
            </div>
          `;
        }
        
        // FACEBOOK (por defecto)
        const isMobile = window.innerWidth < 768;
        // Permitir ancho personalizado por post
        const fbWidth = post.width || (isMobile ? 'auto' : '700');
        const hasCustomWidth = post.width && post.width > 500;
        const customWidthClass = hasCustomWidth ? 'custom-width' : '';
        const embedWideClass = hasCustomWidth ? 'wide' : '';
        console.log(`üìä Post ${post.id}: width=${post.width}, fbWidth=${fbWidth}, customClass=${customWidthClass}`);
        const enableZoom = post.enableZoom !== false; // Por defecto true
        const zoom = post.zoom || 1;
        const offsetX = post.offsetX || 0;
        const offsetY = post.offsetY || 0;
        const zoomClass = enableZoom ? 'fb-post-zoom' : '';
        const dataAttrs = enableZoom ? `data-zoom="${zoom}" data-offset-x="${offsetX}" data-offset-y="${offsetY}"` : '';
        
        return `
          <div class="fb-post-wrapper ${customWidthClass}" style="animation-delay: ${index * 0.1}s">
            ${title}
            <div class="fb-embed-container ${embedWideClass}">
              <div class="fb-post ${zoomClass}" ${dataAttrs}
                   data-href="${post.url}?t=${Date.now()}" 
                   data-width="${fbWidth}" 
                   data-show-text="false">
              </div>
            </div>
            ${description}
          </div>
        `;
      }
      
      async function loadFacebookPosts() {
        try {
          // Evitar cargas duplicadas
          if (postsLoaded) {
            console.log('‚ö†Ô∏è Posts ya cargados, saltando...');
            return;
          }
          postsLoaded = true;
          
          const container = document.getElementById('facebookPostsContainer');
          if (!container) {
            console.error('‚ùå No se encontr√≥ facebookPostsContainer');
            return;
          }
          
          // FORZAR LIMPIEZA DE CACHE PARA DEBUGGING
          sessionStorage.removeItem(CACHE_KEY);
          localStorage.removeItem(CACHE_KEY); // Limpiar tambi√©n localStorage
          console.log('üßπ Cache limpiado (session + local)');
          
          // Intentar cargar orden cacheado
          const cached = sessionStorage.getItem(CACHE_KEY);
          let sortedPosts;
          
          if (cached) {
            const cacheData = JSON.parse(cached);
            if (Date.now() - cacheData.timestamp < CACHE_DURATION) {
              sortedPosts = cacheData.posts;
              console.log('‚ö° Facebook posts desde cache');
            }
          }
          
          if (!sortedPosts) {
            console.log('üì• Cargando facebook-posts.json...');
            const response = await fetch('./facebook-posts.json');
            if (!response.ok) throw new Error('Error al cargar facebook-posts.json');
            const posts = await response.json();
            console.log('üì¶ Posts recibidos:', posts);
            sortedPosts = sortPosts(posts);
            console.log('üìä Posts despu√©s de sortear:', sortedPosts);
            
            // Guardar en cache
            sessionStorage.setItem(CACHE_KEY, JSON.stringify({
              posts: sortedPosts,
              timestamp: Date.now()
            }));
            console.log('‚úÖ Facebook posts cargados: ' + sortedPosts.length);
          }
          
          // Si no hay posts activos, ocultar el contenedor
          if (sortedPosts.length === 0) {
            container.style.display = 'none';
            return;
          }
          
          // Generar HTML
          sortedPosts.forEach((post, index) => {
            container.insertAdjacentHTML('beforeend', generatePostHTML(post, index));
          });
          
          // Parsear los posts de Facebook con el SDK
          if (window.FB) {
            window.FB.XFBML.parse(container);
          }
          
          // Procesar embeds de Instagram
          if (window.instgrm) {
            console.log('üì∑ Procesando embeds de Instagram...');
            window.instgrm.Embeds.process();
          } else {
            console.log('‚è≥ Esperando SDK de Instagram...');
            setTimeout(() => {
              if (window.instgrm) {
                console.log('üì∑ Instagram SDK cargado, procesando...');
                window.instgrm.Embeds.process();
              }
            }, 2000);
          }
          
          // Aplicar zoom a los iframes - con reintentos para mobile
          function applyZoomToIframes() {
            document.querySelectorAll('.fb-post-zoom').forEach(postDiv => {
              const zoom = parseFloat(postDiv.dataset.zoom) || 1;
              const offsetX = parseFloat(postDiv.dataset.offsetX) || 0;
              const offsetY = parseFloat(postDiv.dataset.offsetY) || 0;
              
              if (zoom !== 1 || offsetX !== 0 || offsetY !== 0) {
                const iframe = postDiv.querySelector('iframe');
                if (iframe) {
                  iframe.style.transform = `scale(${zoom}) translate(${offsetX}px, ${offsetY}px)`;
                  iframe.style.transformOrigin = 'center center';
                  iframe.style.transition = 'none'; // Sin transici√≥n para evitar flashes
                }
              }
            });
          }
          
          // Aplicar zoom con m√∫ltiples intentos
          setTimeout(applyZoomToIframes, 2000);
          setTimeout(applyZoomToIframes, 4000);
          setTimeout(applyZoomToIframes, 6000);
          
          // MutationObserver para detectar cuando Facebook regenera los iframes
          const mutationObserver = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
              if (mutation.addedNodes.length) {
                mutation.addedNodes.forEach((node) => {
                  // Si se agreg√≥ un iframe, reaplicar zoom
                  if (node.tagName === 'IFRAME' || (node.querySelector && node.querySelector('iframe'))) {
                    setTimeout(applyZoomToIframes, 100);
                  }
                });
              }
            });
          });
          
          // Observer para detectar cuando se cargan iframes y videos nuevos (lazy loading / autoplay)
          if ('IntersectionObserver' in window) {
            const observer = new IntersectionObserver((entries) => {
              entries.forEach(entry => {
                const wrapper = entry.target;

                // Reaplicar zoom cuando el wrapper aparece
                if (entry.isIntersecting) {
                  setTimeout(applyZoomToIframes, 500);
                  setTimeout(applyZoomToIframes, 1500);
                }

                // Lazy-load y autoplay para videos locales (usando data-src)
                try {
                  const vid = wrapper.querySelector('video[data-src]');
                  if (vid) {
                    // Si entra en vista, asignar src y reproducir si corresponde
                    if (entry.isIntersecting) {
                      if (!vid.dataset.loaded) {
                        // asignar fuente
                        vid.src = vid.dataset.src;
                        // Si no hay <source>, asignar directamente y llamar load
                        vid.load();
                        vid.dataset.loaded = '1';
                      }

                      // Reproducir si el post pide autoplay
                      const shouldAutoplay = wrapper.dataset.autoplay === 'true' || wrapper.getAttribute('data-autoplay') === 'true';
                      if (shouldAutoplay) {
                        vid.play().catch(() => { /* autoplay puede ser bloqueado */ });
                      }
                    } else {
                      // fuera de vista: pausar para ahorrar CPU/banda
                      if (!vid.paused) {
                        try { vid.pause(); } catch(e){}
                      }
                    }
                  }
                } catch (e) {
                  console.warn('Error manejando video lazy-load:', e);
                }

                // Tambi√©n reaplicar zoom si aparecen iframes dentro
                if (entry.isIntersecting) {
                  setTimeout(applyZoomToIframes, 500);
                }
              });
            }, { threshold: 0.25 });

            document.querySelectorAll('.fb-post-wrapper').forEach(wrapper => {
              observer.observe(wrapper);
              // Tambi√©n observar mutaciones dentro de cada wrapper
              mutationObserver.observe(wrapper, {
                childList: true,
                subtree: true
              });
            });
          }
          
        } catch (error) {
          console.error('‚ùå Error al cargar publicaciones de Facebook:', error);
        }
      }
      
      // Esperar a que el SDK de Facebook est√© listo
      window.fbAsyncInit = function() {
        console.log('üì± SDK de Facebook cargado');
        loadFacebookPosts();
      };
      
      // Fallback si el SDK ya est√° cargado
      if (window.FB) {
        console.log('üì± SDK de Facebook ya estaba cargado');
        loadFacebookPosts();
      } else {
        console.log('‚è≥ Esperando SDK de Facebook...');
      }
      
      // Timeout de seguridad por si el SDK no carga
      setTimeout(() => {
        console.log('‚è∞ Timeout: forzando carga de posts');
        loadFacebookPosts();
      }, 5000);
    })();
  </script>